---
import ContentLayout from "../../layouts/ContentLayout.astro";
import { processPostContent } from "../../libs/processPost";
import { getPreviewById } from "../api/preview";
import { getPreviewData } from "../../libs/fetchWP";

const previewId = Astro.url.searchParams.get("preview");
let post;
if (previewId) {
  post = await getPreviewData(previewId);
}
if (!post) {
  const { fetchPreviewPostBySlug } = await import("../libs/fetchWP");
  post = await fetchPreviewPostBySlug(Astro.params.slug);
}

const content = await processPostContent(post.content.rendered);
---

<ContentLayout
  title={post.title.rendered}
  description={post.excerpt?.rendered ?? ""}
  published_at={post.date}
  lastModified={post.modified}
  readingTime={post.readingTime}
  wordsCount={post.wordCount}
  slug={post.slug}
>
  <div set:html={content} />
</ContentLayout>
