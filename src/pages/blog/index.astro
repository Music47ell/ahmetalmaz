---
import BaseLayout from "../../layouts/BaseLayout.astro";
import siteMetadata from "../../data/siteMetadata";

import Link from "../../components/Link.astro";

const response = await fetch(import.meta.env.WP_GRAPHQL_URL, {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    query: `
         query HomePagePosts {
           posts(where: { orderby: { field: DATE, order: DESC } }) {
            nodes {
              slug
              title
            }
          }
         }
       `,
  }),
});

const json = await response.json();
const posts = json.data.posts.nodes;
const totalPosts = posts.length;
---

<BaseLayout
  title="Blog"
  description={siteMetadata.description}
  type="website"
  slug="/blog"
>
  <main
    class="divide-y divide-yellow-500 overflow-hidden border border-yellow-500"
  >
    <section>
      <h2 class="p-4 text-lg font-semibold">Posts ({totalPosts})</h2>
      {
        posts.map((post: { slug: string; title: string }) => (
          <div class="flex justify-between gap-x-4 p-4 max-sm:flex-col border-t border-yellow-500">
            <Link href={`blog/${post.slug}`}>{post.title}</Link>
            {/* <ViewsCounter slug={post.slug} trackViews={false} /> */}
          </div>
        ))
      }
    </section>
  </main>
</BaseLayout>